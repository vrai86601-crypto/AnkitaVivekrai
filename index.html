<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Study Portal - Universal</title>
    
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Devanagari:wght@400;600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #e31e24; --dark: #0f0f0f; --card: #1a1a1a; --text: #ffffff; }
        body { font-family: 'Poppins', 'IBM Plex Sans Devanagari', sans-serif; background: var(--dark); color: var(--text); margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .auth-box { background: var(--card); padding: 30px; border-radius: 20px; width: 100%; max-width: 380px; box-shadow: 0 15px 35px rgba(0,0,0,0.7); border: 1px solid #333; text-align: center; }
        h2 { color: var(--primary); margin-bottom: 5px; font-size: 28px; }
        .form-input { width: 100%; padding: 14px; background: #2a2a2a; border: 1px solid #444; border-radius: 10px; color: white; box-sizing: border-box; margin-bottom: 15px; outline: none; }
        .btn-main { width: 100%; padding: 14px; background: var(--primary); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn-main:hover { transform: scale(1.02); background: #c01a1f; }
        .hidden { display: none; }
        #welcomeScreen { padding: 40px; text-align: center; }
    </style>
</head>
<body>

    <div class="auth-box" id="authScreen">
        <h2 id="title">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</h2>
        <p style="color:#aaa; font-size:14px; margin-bottom:20px;">AI Study Portal ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</p>

        <div id="loginSection">
            <input type="text" id="email" class="form-input" placeholder="‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§à‡§Æ‡•á‡§≤">
            <input type="password" id="password" class="form-input" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
            <button class="btn-main" id="loginBtn" type="button">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
        </div>

        <div id="signupSection" class="hidden">
            <input type="text" id="s-name" class="form-input" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
            <input type="email" id="s-email" class="form-input" placeholder="‡§à‡§Æ‡•á‡§≤">
            <input type="password" id="s-password" class="form-input" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
            <button class="btn-main" id="signupBtn" type="button">‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Å</button>
        </div>

        <p style="margin-top:20px; font-size:14px; color:#aaa;" id="toggleText">
            ‡§ñ‡§æ‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à? <a href="javascript:void(0)" id="toggleLink" style="color:var(--primary); text-decoration:none;">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</a>
        </p>
    </div>

    <div id="welcomeScreen" class="hidden">
        <h1 style="color:var(--primary);">‡§®‡§Æ‡§∏‡•ç‡§§‡•á, <span id="userNameDisplay">‡§õ‡§æ‡§§‡•ç‡§∞</span>! üëã</h1>
        <p>‡§Ü‡§™‡§ï‡•Ä ‡§™‡•ù‡§æ‡§à ‡§ï‡•á ‡§≤‡§ø‡§è AI ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à‡•§</p>
        <button class="btn-main" id="logoutBtn" style="width:auto; padding:10px 20px;">Logout</button>
    </div>

    <script>
        // Firebase Config (‡§Ü‡§™‡§ï‡•Ä ‡§¶‡•Ä ‡§π‡•Å‡§à)
        const firebaseConfig = {
            apiKey: "AIzaSyCVaemlk94fylsQDDBy7XaR2J8sR7vrosw",
            authDomain: "ankita-3118d.firebaseapp.com",
            projectId: "ankita-3118d",
            storageBucket: "ankita-3118d.firebasestorage.app",
            messagingSenderId: "20444353775",
            appId: "1:20444353775:web:e76d8677769a3cb64d771a"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const authScreen = document.getElementById('authScreen');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const loginSection = document.getElementById('loginSection');
        const signupSection = document.getElementById('signupSection');
        const titleEl = document.getElementById('title');
        const toggleText = document.getElementById('toggleText');
        const toggleLink = document.getElementById('toggleLink');
        const userNameDisplay = document.getElementById('userNameDisplay');

        // Buttons
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const logoutBtn = document.getElementById('logoutBtn');

        // --------------------------------------------------------------
        // Auth State Observer ‚Äì ‡§Ø‡§π ‡§¶‡•á‡§ñ‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§Ø‡•Ç‡§ú‡§∞ ‡§≤‡•â‡§ó‡§ø‡§® ‡§π‡•à ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç
        // --------------------------------------------------------------
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // ‡§Ø‡•Ç‡§ú‡§∞ ‡§≤‡•â‡§ó‡§ø‡§® ‡§π‡•à ‚Äì ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡§ø‡§ñ‡§æ‡§ì
                showDashboard(user);
            } else {
                // ‡§Ø‡•Ç‡§ú‡§∞ ‡§≤‡•â‡§ó‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‚Äì Auth ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§¶‡§ø‡§ñ‡§æ‡§ì
                authScreen.classList.remove('hidden');
                welcomeScreen.classList.add('hidden');
            }
        });

        // --------------------------------------------------------------
        // ‡§≤‡•â‡§ó‡§ø‡§® ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® (‡§¨‡§ü‡§® ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§™‡§∞)
        // --------------------------------------------------------------
        async function handleLogin() {
            let emailInput = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            // Validation
            if (!emailInput || !password) {
                alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§à‡§Æ‡•á‡§≤/‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç");
                return;
            }
            if (password.length < 6) {
                alert("‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 6 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è");
                return;
            }

            // Auto-append @gmail.com ‡§Ö‡§ó‡§∞ ‡§à‡§Æ‡•á‡§≤ ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à
            if (!emailInput.includes('@')) {
                emailInput = emailInput + '@gmail.com';
            }

            try {
                await auth.signInWithEmailAndPassword(emailInput, password);
                // onAuthStateChanged ‡§∏‡§Ç‡§≠‡§æ‡§≤ ‡§≤‡•á‡§ó‡§æ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡§ø‡§ñ‡§æ‡§®‡§æ
            } catch (error) {
                alert("‡§≤‡•â‡§ó‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§ó‡§≤‡§§‡•Ä: " + error.message);
            }
        }

        // --------------------------------------------------------------
        // ‡§∏‡§æ‡§á‡§®‡§Ö‡§™ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
        // --------------------------------------------------------------
        async function handleSignup() {
            const name = document.getElementById('s-name').value.trim();
            const email = document.getElementById('s-email').value.trim();
            const password = document.getElementById('s-password').value;

            // Validation
            if (!name || !email || !password) {
                alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç");
                return;
            }
            if (password.length < 6) {
                alert("‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 6 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è");
                return;
            }

            try {
                const cred = await auth.createUserWithEmailAndPassword(email, password);
                // Firestore ‡§Æ‡•á‡§Ç ‡§®‡§æ‡§Æ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•ã
                await db.collection('students').doc(cred.user.uid).set({
                    Name: name,
                    Email: email
                });
                // onAuthStateChanged ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡§ø‡§ñ‡§æ ‡§¶‡•á‡§ó‡§æ ‚Äì ‡§¨‡§ø‡§®‡§æ ‡§∞‡•Ä‡§≤‡•ã‡§° ‡§ï‡•á
            } catch (error) {
                alert("‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ó‡§≤‡§§‡•Ä: " + error.message);
            }
        }

        // --------------------------------------------------------------
        // ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡§æ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
        // --------------------------------------------------------------
        function showDashboard(user) {
            authScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            // ‡§à‡§Æ‡•á‡§≤ ‡§∏‡•á ‡§™‡§π‡§≤‡§æ ‡§≠‡§æ‡§ó ‡§®‡§ø‡§ï‡§æ‡§≤‡§ï‡§∞ ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å (‡§ú‡•à‡§∏‡•á "‡§∞‡§æ‡§π‡•Å‡§≤")
            const displayName = user.email ? user.email.split('@')[0] : '‡§õ‡§æ‡§§‡•ç‡§∞';
            userNameDisplay.innerText = displayName;
        }

        // --------------------------------------------------------------
        // ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü
        // --------------------------------------------------------------
        function logout() {
            auth.signOut();  // onAuthStateChanged ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§¨‡§¶‡§≤ ‡§¶‡•á‡§ó‡§æ
        }

        // --------------------------------------------------------------
        // ‡§ü‡•â‡§ó‡§≤ UI (Login / Signup)
        // --------------------------------------------------------------
        function toggleUI(showSignup) {
            if (showSignup) {
                // Signup ‡§´‡•â‡§∞‡•ç‡§Æ ‡§¶‡§ø‡§ñ‡§æ‡§ì
                loginSection.classList.add('hidden');
                signupSection.classList.remove('hidden');
                titleEl.innerText = "‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç";
                toggleText.innerHTML = '‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à? <a href="javascript:void(0)" id="toggleLink" style="color:var(--primary);">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</a>';
                // ‡§®‡§è ‡§≤‡§ø‡§Ç‡§ï ‡§™‡§∞ ‡§á‡§µ‡•á‡§Ç‡§ü ‡§≤‡§ó‡§æ‡§ì
                document.getElementById('toggleLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleUI(false);
                });
            } else {
                // Login ‡§´‡•â‡§∞‡•ç‡§Æ ‡§¶‡§ø‡§ñ‡§æ‡§ì
                loginSection.classList.remove('hidden');
                signupSection.classList.add('hidden');
                titleEl.innerText = "‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç";
                toggleText.innerHTML = '‡§ñ‡§æ‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à? <a href="javascript:void(0)" id="toggleLink" style="color:var(--primary);">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</a>';
                document.getElementById('toggleLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleUI(true);
                });
            }
        }

        // --------------------------------------------------------------
        // Event Listeners
        // --------------------------------------------------------------
        loginBtn.addEventListener('click', handleLogin);
        signupBtn.addEventListener('click', handleSignup);
        logoutBtn.addEventListener('click', logout);

        // ‡§ü‡•â‡§ó‡§≤ ‡§≤‡§ø‡§Ç‡§ï (‡§™‡§π‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è)
        toggleLink.addEventListener('click', (e) => {
            e.preventDefault();
            // ‡§™‡§§‡§æ ‡§ï‡§∞‡•ã ‡§ï‡§ø ‡§Ö‡§≠‡•Ä ‡§ï‡•å‡§® ‡§∏‡§æ ‡§∏‡•á‡§ï‡•ç‡§∂‡§® ‡§¶‡§ø‡§ñ ‡§∞‡§π‡§æ ‡§π‡•à
            const isSignupVisible = !signupSection.classList.contains('hidden');
            toggleUI(!isSignupVisible);  // ‡§â‡§≤‡•ç‡§ü‡§æ ‡§ï‡§∞ ‡§¶‡•ã
        });

        // ‡§è‡§Ç‡§ü‡§∞ ‡§ï‡•Ä ‡§∏‡•á ‡§´‡•â‡§∞‡•ç‡§Æ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§® ‡§π‡•ã (‡§¨‡§ü‡§® ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä type="button" ‡§π‡•à‡§Ç)
        // ‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï: Enter ‡§¶‡§¨‡§æ‡§®‡•á ‡§™‡§∞ ‡§≠‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§∞‡•á‡§Ç
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    if (!signupSection.classList.contains('hidden')) {
                        handleSignup();
                    } else {
                        handleLogin();
                    }
                }
            });
        });
    </script>
</body>
</html>