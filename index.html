<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Study Portal ‚Äî ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§≤‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó</title>
    
    <!-- Firebase SDK (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        /* ----- modern & responsive design (same as original, kept intact) ----- */
        :root { 
            --primary: #e31e24; 
            --primary-dark: #b71c1c;
            --accent: #00d4ff; 
            --dark: #0b0b0b;
            --card-bg: rgba(255,255,255,0.05);
            --border: #333;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 50%, #16213e 100%); 
            color: white; 
            min-height: 100vh; 
            line-height: 1.6;
        }
        
        /* auth container */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        .auth-box { 
            background: rgba(20, 20, 20, 0.95); 
            padding: 40px 30px; 
            border-radius: 25px; 
            border: 1px solid var(--border); 
            width: 100%;
            max-width: 420px; 
            text-align: center; 
            box-shadow: 0 25px 80px rgba(0,0,0,0.6); 
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }
        
        .auth-box::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        .logo { font-size: 48px; margin-bottom: 10px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
        
        .form-input { 
            width:100%; padding:15px 20px; margin:10px 0; border-radius:12px; 
            border:2px solid #333; background:#1a1a1a; color:white; font-size:16px; 
            transition: all 0.3s;
        }
        .form-input:focus { outline:none; border-color:var(--primary); box-shadow:0 0 0 4px rgba(227,30,36,0.1); transform:translateY(-2px); }
        
        .btn { 
            width:100%; padding:15px; border:none; border-radius:12px; cursor:pointer; 
            font-weight:700; font-size:16px; transition:all 0.3s; display:flex;
            align-items:center; justify-content:center; gap:10px; margin:8px 0;
        }
        .btn-primary { background:linear-gradient(135deg, var(--primary), var(--primary-dark)); color:white; box-shadow:0 4px 15px rgba(227,30,36,0.4); }
        .btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 25px rgba(227,30,36,0.5); }
        .btn-google { background:white; color:#333; border:2px solid #ddd; }
        .btn-google:hover { background:#f5f5f5; transform:translateY(-2px); }
        .btn-guest { background:transparent; color:var(--accent); border:2px solid var(--accent); }
        .btn-guest:hover { background:var(--accent); color:#0f0f0f; transform:translateY(-2px); }
        .btn-secondary { background:transparent; color:#aaa; border:2px solid #555; font-size:14px; padding:12px; }
        .btn-secondary:hover { border-color:var(--primary); color:var(--primary); }
        .hidden { display:none !important; }
        
        .divider { 
            color:#666; margin:25px 0; font-size:14px; display:flex; align-items:center; gap:15px; 
        }
        .divider::before, .divider::after { content:''; flex:1; height:1px; background:linear-gradient(90deg, transparent, #444, transparent); }
        
        .toggle-text { margin-top:20px; color:#aaa; font-size:15px; }
        .toggle-text a { color:var(--primary); text-decoration:none; font-weight:600; cursor:pointer; }
        .toggle-text a:hover { text-decoration:underline; }
        
        .error-msg { color:#ff6b6b; font-size:14px; margin:10px 0; padding:10px; background:rgba(255,0,0,0.1); border-radius:8px; border-left:3px solid #ff6b6b; display:none; }
        .success-msg { color:#51cf66; font-size:14px; margin:10px 0; padding:10px; background:rgba(0,255,0,0.1); border-radius:8px; border-left:3px solid #51cf66; display:none; }

        /* dashboard */
        .dashboard { display:none; min-height:100vh; animation:fadeIn 0.6s ease; }
        .dashboard.active { display:block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }
        
        .header { 
            display:flex; justify-content:space-between; align-items:center; padding:20px 30px; 
            background:rgba(255,255,255,0.03); border-bottom:1px solid var(--border); position:sticky; top:0;
            backdrop-filter:blur(10px); z-index:100;
        }
        .user-info { display:flex; align-items:center; gap:15px; }
        .avatar { 
            width:50px; height:50px; border-radius:50%; background:linear-gradient(135deg, var(--primary), var(--primary-dark));
            display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:bold;
            border:2px solid rgba(255,255,255,0.1);
        }
        .guest-avatar { background:linear-gradient(135deg, #ff9800, #f57c00); }
        .guest-badge { background:linear-gradient(135deg, #ff9800, #f57c00); padding:4px 12px; border-radius:20px; font-size:11px; margin-left:8px; font-weight:700; text-transform:uppercase; }
        
        .btn-logout { background:rgba(255,255,255,0.1); color:white; border:1px solid #444; padding:10px 20px; border-radius:10px; cursor:pointer; font-weight:600; transition:all 0.3s; }
        .btn-logout:hover { background:rgba(255,255,255,0.2); border-color:var(--primary); color:var(--primary); }
        
        .container { max-width:1400px; margin:0 auto; padding:30px; }
        .welcome-text { margin-bottom:30px; }
        .welcome-text h1 { font-size:32px; margin-bottom:10px; background:linear-gradient(90deg, white, var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .welcome-text p { color:#aaa; font-size:18px; }
        
        .upgrade-banner { 
            background:linear-gradient(135deg, rgba(227,30,36,0.9), rgba(183,28,28,0.9)); padding:25px; border-radius:20px; 
            margin-bottom:30px; text-align:center; border:1px solid rgba(255,255,255,0.1); display:none; animation:slideDown 0.5s ease;
        }
        .upgrade-banner.show { display:block; }
        @keyframes slideDown { from{transform:translateY(-20px); opacity:0;} to{transform:translateY(0); opacity:1;} }
        .upgrade-banner h3 { font-size:22px; margin-bottom:10px; }
        
        .grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(320px, 1fr)); gap:25px; }
        .card { 
            background:var(--card-bg); padding:30px; border-radius:20px; border:1px solid var(--border); transition:all 0.3s; cursor:pointer;
            position:relative; overflow:hidden;
        }
        .card::before { content:''; position:absolute; top:0; left:0; width:100%; height:4px; background:linear-gradient(90deg, var(--primary), var(--accent)); transform:scaleX(0); transition:transform 0.3s; }
        .card:hover { transform:translateY(-5px); border-color:var(--primary); box-shadow:0 20px 40px rgba(0,0,0,0.4); }
        .card:hover::before { transform:scaleX(1); }
        .card-icon { font-size:48px; margin-bottom:20px; display:inline-block; transition:transform 0.3s; }
        .card:hover .card-icon { transform:scale(1.1); }
        .card h3 { margin:0 0 12px 0; color:white; font-size:22px; }
        .card p { color:#999; margin:0; font-size:15px; line-height:1.6; }
        
        .progress-section { margin-top:20px; }
        .progress-header { display:flex; justify-content:space-between; font-size:13px; color:#aaa; margin-bottom:8px; }
        .progress-bar { width:100%; height:8px; background:#222; border-radius:10px; overflow:hidden; }
        .progress-fill { height:100%; background:linear-gradient(90deg, var(--primary), var(--accent)); width:0%; transition:width 1s ease; border-radius:10px; }
        
        .timer { 
            position:fixed; top:20px; right:20px; background:rgba(0,0,0,0.9); padding:12px 24px; border-radius:30px; 
            border:2px solid var(--primary); font-family:'Courier New', monospace; font-size:18px; font-weight:bold;
            z-index:1000; box-shadow:0 4px 20px rgba(0,0,0,0.5); display:flex; align-items:center; gap:10px;
        }
        .timer.warning { border-color:#ff9800; color:#ff9800; animation:pulse 1s infinite; }
        .timer.danger { border-color:#ff0000; color:#ff0000; animation:pulse 0.5s infinite; }
        @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.7;} }
        
        .feature-modal {
            position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.9); display:none; align-items:center;
            justify-content:center; z-index:2000; padding:20px;
        }
        .feature-modal.active { display:flex; animation:fadeIn 0.3s; }
        .modal-content { background:#1a1a1a; padding:40px; border-radius:25px; max-width:600px; width:100%; border:1px solid var(--border); text-align:center; }
        .modal-content h2 { font-size:28px; margin-bottom:20px; color:var(--accent); }
        .close-modal { background:var(--primary); color:white; border:none; padding:12px 30px; border-radius:10px; cursor:pointer; font-weight:600; }
        
        @media (max-width:768px) {
            .header { flex-direction:column; gap:15px; }
            .welcome-text h1 { font-size:24px; }
            .grid { grid-template-columns:1fr; }
            .timer { top:auto; bottom:20px; right:20px; font-size:16px; }
        }
        
        .spinner { width:20px; height:20px; border:3px solid rgba(255,255,255,0.3); border-radius:50%; border-top-color:white; animation:spin 1s ease-in-out infinite; display:none; }
        @keyframes spin { to { transform:rotate(360deg); } }
        .btn.loading .spinner { display:inline-block; }
        .btn.loading .btn-text { display:none; }
    </style>
</head>
<body>

    <!-- Guest Timer Display -->
    <div id="guestTimer" class="timer hidden">
        <span>‚è±Ô∏è</span>
        <span id="timeLeft">30:00</span>
    </div>

    <!-- Auth Screen (Login/Register) -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box" id="authScreen">
            <div class="logo">üéì</div>
            <h2 style="font-size: 28px; margin-bottom: 8px;">AI Study Portal</h2>
            <p style="color: #888; margin-bottom: 25px;">‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§≤‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó ‡§ï‡§æ ‡§®‡§Ø‡§æ ‡§Ø‡•Å‡§ó</p>

            <div id="errorMsg" class="error-msg"></div>
            <div id="successMsg" class="success-msg"></div>

            <!-- Login Form -->
            <div id="loginForm">
                <button class="btn btn-google" id="googleBtn" type="button">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" width="20"> 
                    <span class="btn-text">Google ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á‡§Ç</span>
                    <div class="spinner"></div>
                </button>

                <div class="divider">‡§Ø‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§∏‡•á</div>

                <input type="email" id="email" class="form-input" placeholder="üìß ‡§à‡§Æ‡•á‡§≤ ‡§è‡§°‡•ç‡§∞‡•á‡§∏">
                <input type="password" id="password" class="form-input" placeholder="üîí ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
                
                <button class="btn btn-primary" id="loginBtn" type="button">
                    <span class="btn-text">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</span>
                    <div class="spinner"></div>
                </button>
                
                <button class="btn btn-secondary" id="showRegisterBtn" type="button">
                    ‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç
                </button>

                <div class="divider">‡§Ø‡§æ</div>

                <button class="btn btn-guest" id="guestBtn" type="button">
                    <span class="btn-text">üöÄ ‡§¨‡§ø‡§®‡§æ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç</span>
                </button>
                
                <p style="margin-top: 20px; color: #666; font-size: 13px;">
                    üïê ‡§ó‡•á‡§∏‡•ç‡§ü ‡§Æ‡•ã‡§°: 30 ‡§Æ‡§ø‡§®‡§ü ‡§Æ‡•Å‡§´‡•ç‡§§<br>‚≠ê ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç: ‡§Ö‡§®‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§° ‡§è‡§ï‡•ç‡§∏‡•á‡§∏
                </p>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <h3 style="margin-bottom: 20px; color: var(--accent);">‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç</h3>
                
                <input type="text" id="regName" class="form-input" placeholder="üë§ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
                <input type="email" id="regEmail" class="form-input" placeholder="üìß ‡§à‡§Æ‡•á‡§≤ ‡§è‡§°‡•ç‡§∞‡•á‡§∏">
                <input type="password" id="regPassword" class="form-input" placeholder="üîí ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° (6+ ‡§Ö‡§ï‡•ç‡§∑‡§∞)">
                <input type="password" id="regConfirmPassword" class="form-input" placeholder="üîí ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡•ã‡§π‡§∞‡§æ‡§è‡§Ç">
                
                <button class="btn btn-primary" id="registerBtn" type="button">
                    <span class="btn-text">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</span>
                    <div class="spinner"></div>
                </button>
                
                <p class="toggle-text">
                    ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à? <a id="showLoginBtn">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Dashboard (Main App) -->
    <div id="dashboard" class="dashboard">
        <div class="header">
            <div class="user-info">
                <div class="avatar" id="userAvatar">üë§</div>
                <div>
                    <h3 style="margin: 0; font-size: 20px;">
                        ‡§®‡§Æ‡§∏‡•ç‡§§‡•á, <span id="userNameDisplay">‡§õ‡§æ‡§§‡•ç‡§∞</span>!
                        <span id="guestBadge" class="guest-badge hidden">Guest</span>
                    </h3>
                    <p style="margin: 5px 0 0 0; color: #888; font-size: 14px;" id="userStatus">‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç...</p>
                </div>
            </div>
            <button class="btn-logout" id="logoutBtn">üö™ ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
        </div>

        <div class="container">
            <div class="welcome-text">
                <h1>‡§Ü‡§ú ‡§ï‡•ç‡§Ø‡§æ ‡§™‡§¢‡§º‡•á‡§Ç‡§ó‡•á? üìö</h1>
                <p id="welcomeSubtext">‡§Ö‡§™‡§®‡•Ä ‡§∏‡•Ä‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç...</p>
            </div>

            <div id="upgradeBanner" class="upgrade-banner">
                <h3>‚è∞ ‡§∏‡§Æ‡§Ø ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§π‡•à!</h3>
                <p>‡§Ö‡§®‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§° ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§î‡§∞ ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§≠‡•Ä ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                <button class="btn btn-primary" onclick="switchToLogin()" style="width: auto; padding: 12px 35px; margin: 0 auto;">
                    ‡§Ö‡§≠‡•Ä ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç
                </button>
            </div>

            <div class="grid">
                <div class="card" onclick="openFeature('ai-tutor', 'AI ‡§ü‡•ç‡§Ø‡•Ç‡§ü‡§∞')">
                    <div class="card-icon">ü§ñ</div>
                    <h3>AI ‡§ü‡•ç‡§Ø‡•Ç‡§ü‡§∞</h3>
                    <p>24/7 ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Ü‡§™‡§ï‡§æ ‡§®‡§ø‡§ú‡•Ä ‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï‡•§ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§µ‡§ø‡§∑‡§Ø ‡§Æ‡•á‡§Ç ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§Æ‡§¶‡§¶ ‡§™‡§æ‡§è‡§Ç‡•§</p>
                    <div class="progress-section"><div class="progress-header"><span>‡§™‡•ç‡§∞‡§ó‡§§‡§ø</span><span>75%</span></div><div class="progress-bar"><div class="progress-fill" style="width:75%"></div></div></div>
                </div>
                <div class="card" onclick="openFeature('smart-notes', '‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§®‡•ã‡§ü‡•ç‡§∏')">
                    <div class="card-icon">üìù</div>
                    <h3>‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§®‡•ã‡§ü‡•ç‡§∏</h3>
                    <p>AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ú‡§®‡§∞‡•á‡§ü‡•á‡§° ‡§∏‡§Ç‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§§ ‡§®‡•ã‡§ü‡•ç‡§∏, ‡§Æ‡§æ‡§á‡§Ç‡§° ‡§Æ‡•à‡§™‡•ç‡§∏ ‡§î‡§∞ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§¨‡§ø‡§Ç‡§¶‡•Å‡•§</p>
                    <div class="progress-section"><div class="progress-header"><span>‡§™‡•ç‡§∞‡§ó‡§§‡§ø</span><span>60%</span></div><div class="progress-bar"><div class="progress-fill" style="width:60%"></div></div></div>
                </div>
                <div class="card" onclick="openFeature('practice-quiz', '‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡•ç‡§µ‡§ø‡§ú')">
                    <div class="card-icon">üéØ</div>
                    <h3>‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡•ç‡§µ‡§ø‡§ú</h3>
                    <p>‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®, ‡§Æ‡•â‡§ï ‡§ü‡•á‡§∏‡•ç‡§ü ‡§î‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£‡•§</p>
                    <div class="progress-section"><div class="progress-header"><span>‡§™‡•ç‡§∞‡§ó‡§§‡§ø</span><span>40%</span></div><div class="progress-bar"><div class="progress-fill" style="width:40%"></div></div></div>
                </div>
                <div class="card" onclick="openFeature('progress-report', '‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü')">
                    <div class="card-icon">üìä</div>
                    <h3>‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</h3>
                    <p>‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£, ‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§® ‡§î‡§∞ ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§Ø‡•ã‡§ú‡§®‡§æ‡•§</p>
                    <div class="progress-section"><div class="progress-header"><span>‡§™‡•ç‡§∞‡§ó‡§§‡§ø</span><span>85%</span></div><div class="progress-bar"><div class="progress-fill" style="width:85%"></div></div></div>
                </div>
                <div class="card" onclick="openFeature('doubt-solver', '‡§°‡§æ‡§â‡§ü ‡§∏‡•â‡§≤‡•ç‡§µ‡§∞')">
                    <div class="card-icon">‚ùì</div>
                    <h3>‡§°‡§æ‡§â‡§ü ‡§∏‡•â‡§≤‡•ç‡§µ‡§∞</h3>
                    <p>‡§´‡•ã‡§ü‡•ã ‡§ñ‡•Ä‡§Ç‡§ö‡•á‡§Ç ‡§Ø‡§æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç, AI ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§¶‡•á‡§ó‡§æ‡•§</p>
                    <div class="progress-section"><div class="progress-header"><span>‡§™‡•ç‡§∞‡§ó‡§§‡§ø</span><span>30%</span></div><div class="progress-bar"><div class="progress-fill" style="width:30%"></div></div></div>
                </div>
                <div class="card" onclick="openFeature('study-planner', '‡§∏‡•ç‡§ü‡§°‡•Ä ‡§™‡•ç‡§≤‡§æ‡§®‡§∞')">
                    <div class="card-icon">üìÖ</div>
                    <h3>‡§∏‡•ç‡§ü‡§°‡•Ä ‡§™‡•ç‡§≤‡§æ‡§®‡§∞</h3>
                    <p>AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§∞‡§´‡•á‡§ï‡•ç‡§ü ‡§ü‡§æ‡§á‡§Æ‡§ü‡•á‡§¨‡§≤ ‡§î‡§∞ ‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞‡•§</p>
                    <div class="progress-section"><div class="progress-header"><span>‡§™‡•ç‡§∞‡§ó‡§§‡§ø</span><span>90%</span></div><div class="progress-bar"><div class="progress-fill" style="width:90%"></div></div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feature Modal (placeholder) -->
    <div id="featureModal" class="feature-modal">
        <div class="modal-content">
            <div style="font-size: 60px; margin-bottom: 20px;" id="modalIcon">üöÄ</div>
            <h2 id="modalTitle">‡§´‡•Ä‡§ö‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ</h2>
            <p id="modalDesc">‡§Ø‡§π ‡§´‡•Ä‡§ö‡§∞ ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•ã‡§ó‡§æ...</p>
            <button class="close-modal" onclick="closeModal()">‡§†‡•Ä‡§ï ‡§π‡•à</button>
        </div>
    </div>

    <script>
        (function() {
            // ==================== FIREBASE INIT ====================
            const firebaseConfig = {
                apiKey: "AIzaSyCVaemlk94fyisQOD0y7XaR2J8sR7vrosw",
                authDomain: "ankita-3118d.firebaseapp.com",
                projectId: "ankita-3118d",
                storageBucket: "ankita-3118d.firebasestorage.app",
                messagingSenderId: "20444353775",
                appId: "1:20444353775:web:e76d8677769a3cb64d771a"
            };
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            // ==================== GLOBAL STATE ====================
            let isGuest = false;                // true if guest mode active
            let guestTimerInterval = null;       // reference to setInterval
            let timeLeft = 30 * 60;              // 30 minutes in seconds
            let currentUser = null;               // store Firebase user or guest object

            // DOM elements shortcuts
            const authContainer = document.getElementById('authContainer');
            const dashboard = document.getElementById('dashboard');
            const guestTimerEl = document.getElementById('guestTimer');
            const timeLeftSpan = document.getElementById('timeLeft');
            const upgradeBanner = document.getElementById('upgradeBanner');
            const errorDiv = document.getElementById('errorMsg');
            const successDiv = document.getElementById('successMsg');

            // ==================== UI HELPERS ====================
            function showError(msg) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
                setTimeout(() => errorDiv.style.display = 'none', 5000);
            }

            function showSuccess(msg) {
                successDiv.textContent = msg;
                successDiv.style.display = 'block';
                setTimeout(() => successDiv.style.display = 'none', 3000);
            }

            function setLoading(btnId, loading) {
                const btn = document.getElementById(btnId);
                if (!btn) return;
                if (loading) {
                    btn.classList.add('loading');
                    btn.disabled = true;
                } else {
                    btn.classList.remove('loading');
                    btn.disabled = false;
                }
            }

            function toggleForms(showRegister) {
                document.getElementById('loginForm').classList.toggle('hidden', showRegister);
                document.getElementById('registerForm').classList.toggle('hidden', !showRegister);
            }

            // ==================== AUTH STATE OBSERVER (fixed) ====================
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // Real Firebase user logged in
                    // If guest mode was active, kill it
                    if (isGuest) {
                        clearGuestSession();
                    }
                    isGuest = false;
                    currentUser = user;
                    // Remove any leftover guest flags
                    localStorage.removeItem('guestSession');
                    localStorage.removeItem('guestTimeLeft');
                    localStorage.removeItem('guestStartTime');
                    
                    showDashboard();
                    updateUserUI(user);
                } else {
                    // No Firebase user ‚Äì either guest or logged out
                    if (!isGuest) {
                        // Not guest either ‚Üí show auth screen
                        showAuthScreen();
                    }
                    // if isGuest == true, keep dashboard (handled separately)
                }
            });

            // ==================== DASHBOARD / AUTH SCREEN ====================
            function showDashboard() {
                authContainer.classList.add('hidden');
                dashboard.classList.add('active');
            }

            function showAuthScreen() {
                // Clear any guest remnants if we reach auth screen
                clearGuestSession(); // ensures timer stopped, flags cleared
                dashboard.classList.remove('active');
                authContainer.classList.remove('hidden');
                guestTimerEl.classList.add('hidden');
                upgradeBanner.classList.remove('show');
                toggleForms(false);  // show login form
                // reset input fields
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
            }

            function updateUserUI(user) {
                const name = user.displayName || (user.email ? user.email.split('@')[0] : '‡§õ‡§æ‡§§‡•ç‡§∞');
                document.getElementById('userNameDisplay').innerText = name;
                const avatar = document.getElementById('userAvatar');
                avatar.innerText = name.charAt(0).toUpperCase();
                avatar.classList.remove('guest-avatar');
                document.getElementById('guestBadge').classList.add('hidden');
                document.getElementById('userStatus').innerText = '‚úÖ ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§∏‡§¶‡§∏‡•ç‡§Ø - ‡§Ö‡§®‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§° ‡§è‡§ï‡•ç‡§∏‡•á‡§∏';
                document.getElementById('welcomeSubtext').innerText = '‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§ú ‡§ï‡•ç‡§Ø‡§æ ‡§∏‡•Ä‡§ñ‡•á‡§Ç‡§ó‡•á?';
                guestTimerEl.classList.add('hidden');
                upgradeBanner.classList.remove('show');
            }

            function updateGuestUI() {
                document.getElementById('userNameDisplay').innerText = '‡§Æ‡•á‡§π‡§Æ‡§æ‡§®';
                const avatar = document.getElementById('userAvatar');
                avatar.innerText = 'üë§';
                avatar.classList.add('guest-avatar');
                document.getElementById('guestBadge').classList.remove('hidden');
                document.getElementById('userStatus').innerText = 'üïê 30 ‡§Æ‡§ø‡§®‡§ü ‡§ï‡§æ ‡§Æ‡•Å‡§´‡•ç‡§§ ‡§ü‡•ç‡§∞‡§æ‡§Ø‡§≤';
                document.getElementById('welcomeSubtext').innerText = '‡§Æ‡•á‡§π‡§Æ‡§æ‡§® ‡§Æ‡•ã‡§° - ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§∏‡§Æ‡§Ø ‡§§‡§ï ‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡§∞‡•á‡§Ç';
                guestTimerEl.classList.remove('hidden');
                // banner might appear later via timer
            }

            // ==================== GUEST MODE ====================
            function clearGuestSession() {
                if (guestTimerInterval) {
                    clearInterval(guestTimerInterval);
                    guestTimerInterval = null;
                }
                isGuest = false;
                timeLeft = 30 * 60;
                localStorage.removeItem('guestSession');
                localStorage.removeItem('guestTimeLeft');
                localStorage.removeItem('guestStartTime');
                // also hide timer and banner
                guestTimerEl.classList.add('hidden');
                guestTimerEl.classList.remove('warning','danger');
                upgradeBanner.classList.remove('show');
            }

            function startGuestMode(initialSeconds) {
                // clear any previous guest timer
                clearGuestSession(); 
                
                isGuest = true;
                timeLeft = initialSeconds;
                currentUser = { displayName: '‡§Æ‡•á‡§π‡§Æ‡§æ‡§®', isGuest: true };
                
                // store in localStorage
                localStorage.setItem('guestSession', 'true');
                localStorage.setItem('guestTimeLeft', timeLeft);
                localStorage.setItem('guestStartTime', Date.now());
                
                showDashboard();
                updateGuestUI();
                startGuestTimer();
            }

            function startGuestTimer() {
                updateTimerDisplay(); // immediate

                guestTimerInterval = setInterval(() => {
                    timeLeft--;
                    // update localStorage periodically
                    localStorage.setItem('guestTimeLeft', timeLeft);
                    
                    updateTimerDisplay();

                    // warnings
                    if (timeLeft === 300) { // 5 minutes
                        upgradeBanner.classList.add('show');
                        showSuccess("‚ö†Ô∏è ‡§∏‡§ø‡§∞‡•ç‡§´ 5 ‡§Æ‡§ø‡§®‡§ü ‡§¨‡§ö‡•á ‡§π‡•à‡§Ç! ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§®‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§° ‡§™‡§æ‡§è‡§Ç‡•§");
                    }
                    if (timeLeft === 60) {
                        showError("‚è∞ ‡§ï‡•á‡§µ‡§≤ 1 ‡§Æ‡§ø‡§®‡§ü ‡§∂‡•á‡§∑! ‡§∏‡§Æ‡§Ø ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§∏‡§§‡•ç‡§∞ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ‡•§");
                    }
                    if (timeLeft <= 0) {
                        clearInterval(guestTimerInterval);
                        guestTimerInterval = null;
                        endGuestSession();
                    }
                }, 1000);
            }

            function updateTimerDisplay() {
                const mins = Math.floor(timeLeft / 60);
                const secs = timeLeft % 60;
                timeLeftSpan.innerText = `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
                
                const timerContainer = guestTimerEl;
                if (timeLeft < 60) {
                    timerContainer.classList.add('danger');
                    timerContainer.classList.remove('warning');
                } else if (timeLeft < 300) {
                    timerContainer.classList.add('warning');
                    timerContainer.classList.remove('danger');
                } else {
                    timerContainer.classList.remove('warning','danger');
                }
            }

            function endGuestSession() {
                alert("‚è∞ ‡§∏‡§Æ‡§Ø ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§! ‡§Ö‡§®‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§° ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç‡•§");
                logout(); // this will clear everything and go to auth screen
            }

            // ==================== AUTH ACTIONS ====================
            document.getElementById('googleBtn').onclick = async () => {
                setLoading('googleBtn', true);
                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    await auth.signInWithPopup(provider);
                } catch (error) {
                    console.error("Google Login Error:", error);
                    let msg = "‡§≤‡•â‡§ó‡§ø‡§® ‡§µ‡§ø‡§´‡§≤: ";
                    if (error.code === 'auth/popup-blocked') msg += "‡§™‡•â‡§™‡§Ö‡§™ ‡§¨‡•ç‡§≤‡•â‡§ï ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç‡•§";
                    else if (error.code === 'auth/unauthorized-domain') msg += "‡§Ø‡§π ‡§°‡•ã‡§Æ‡•á‡§® ‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ Firebase Console ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§";
                    else msg += error.message;
                    showError(msg);
                } finally {
                    setLoading('googleBtn', false);
                }
            };

            document.getElementById('loginBtn').onclick = async () => {
                const email = document.getElementById('email').value.trim();
                const pass = document.getElementById('password').value;
                
                if (!email || !pass) return showError("‡§ï‡•É‡§™‡§Ø‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§≠‡§∞‡•á‡§Ç");
                if (!email.includes("@") || !email.includes(".")) return showError("‡§∏‡§π‡•Ä ‡§à‡§Æ‡•á‡§≤ ‡§è‡§°‡•ç‡§∞‡•á‡§∏ ‡§°‡§æ‡§≤‡•á‡§Ç");
                if (pass.length < 6) return showError("‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 6 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è");

                setLoading('loginBtn', true);
                try {
                    await auth.signInWithEmailAndPassword(email, pass);
                    showSuccess("‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§≤‡•â‡§ó‡§ø‡§®!");
                } catch (error) {
                    let msg = "";
                    switch(error.code) {
                        case 'auth/wrong-password': msg = "‚ùå ‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°‡•§"; break;
                        case 'auth/user-not-found': msg = "‚ùå ‡§Ø‡§π ‡§à‡§Æ‡•á‡§≤ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞‡•ç‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ '‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç' ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§"; break;
                        case 'auth/invalid-email': msg = "‚ùå ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§à‡§Æ‡•á‡§≤‡•§"; break;
                        case 'auth/too-many-requests': msg = "‚ö†Ô∏è ‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§∞‡•á ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏, ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§"; break;
                        default: msg = "‚ùå ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: " + error.message;
                    }
                    showError(msg);
                } finally {
                    setLoading('loginBtn', false);
                }
            };

            document.getElementById('registerBtn').onclick = async () => {
                const name = document.getElementById('regName').value.trim();
                const email = document.getElementById('regEmail').value.trim();
                const pass = document.getElementById('regPassword').value;
                const confirmPass = document.getElementById('regConfirmPassword').value;

                if (!name || !email || !pass || !confirmPass) return showError("‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç");
                if (pass !== confirmPass) return showError("‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§Æ‡•á‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§ñ‡§æ ‡§∞‡§π‡•á");
                if (pass.length < 6) return showError("‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 6 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è");

                setLoading('registerBtn', true);
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, pass);
                    await userCredential.user.updateProfile({ displayName: name });
                    await db.collection('users').doc(userCredential.user.uid).set({
                        name, email, createdAt: firebase.firestore.FieldValue.serverTimestamp(), isGuest: false
                    });
                    showSuccess("üéâ ‡§ñ‡§æ‡§§‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§®‡§æ!");
                } catch (error) {
                    let msg = "";
                    switch(error.code) {
                        case 'auth/email-already-in-use': msg = "‚ö†Ô∏è ‡§Ø‡§π ‡§à‡§Æ‡•á‡§≤ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞‡•ç‡§° ‡§π‡•à‡•§ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç‡•§"; break;
                        case 'auth/invalid-email': msg = "‚ùå ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§à‡§Æ‡•á‡§≤‡•§"; break;
                        case 'auth/weak-password': msg = "‚ùå ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§π‡•Å‡§§ ‡§ï‡§Æ‡§ú‡•ã‡§∞‡•§"; break;
                        default: msg = "‚ùå ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: " + error.message;
                    }
                    showError(msg);
                } finally {
                    setLoading('registerBtn', false);
                }
            };

            document.getElementById('guestBtn').onclick = () => {
                startGuestMode(30 * 60);
            };

            // toggle forms
            document.getElementById('showRegisterBtn').onclick = () => toggleForms(true);
            document.getElementById('showLoginBtn').onclick = () => toggleForms(false);

            // logout function (global)
            window.logout = function() {
                clearGuestSession(); // kills guest timer & flags
                isGuest = false;
                currentUser = null;
                auth.signOut().then(() => {
                    // auth observer will show auth screen
                }).catch((e) => {
                    showError("‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ: " + e.message);
                    showAuthScreen(); // fallback
                });
            };
            document.getElementById('logoutBtn').onclick = logout;

            // switch to login (used by upgrade banner)
            window.switchToLogin = function() {
                logout();
                setTimeout(() => document.getElementById('email').focus(), 200);
            };

            // ==================== FEATURE MODAL ====================
            window.openFeature = function(featureId, featureName) {
                const modal = document.getElementById('featureModal');
                const icons = { 'ai-tutor':'ü§ñ','smart-notes':'üìù','practice-quiz':'üéØ','progress-report':'üìä','doubt-solver':'‚ùì','study-planner':'üìÖ' };
                document.getElementById('modalIcon').innerText = icons[featureId] || 'üöÄ';
                document.getElementById('modalTitle').innerText = featureName;
                
                let desc;
                if (isGuest) {
                    const mins = Math.floor(timeLeft / 60);
                    desc = `üéâ ${featureName} ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§≤‡§æ‡§á‡§µ ‡§π‡•ã‡§ó‡§æ!\n\n‚è±Ô∏è ‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ ${mins} ‡§Æ‡§ø‡§®‡§ü ‡§¨‡§ö‡•á ‡§π‡•à‡§Ç (Guest Mode)\n‚≠ê ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§á‡§∏‡•á ‡§∏‡§¨‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡§∞‡•á‡§Ç!`;
                } else {
                    desc = `üéâ ${featureName} ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§≤‡§æ‡§á‡§µ ‡§π‡•ã‡§ó‡§æ!\n\n‚úÖ ‡§Ü‡§™ ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§Ø‡•Ç‡§ú‡§∞ ‡§π‡•à‡§Ç\nüîî ‡§≤‡•â‡§®‡•ç‡§ö ‡§π‡•ã‡§§‡•á ‡§π‡•Ä ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§Æ‡§ø‡§≤‡•á‡§ó‡•Ä!`;
                }
                document.getElementById('modalDesc').innerText = desc;
                modal.classList.add('active');
            };

            window.closeModal = function() {
                document.getElementById('featureModal').classList.remove('active');
            };
            document.getElementById('featureModal').onclick = (e) => { if (e.target.id === 'featureModal') closeModal(); };

            // ==================== SESSION RECOVERY (on load) ====================
            window.addEventListener('load', () => {
                const savedGuest = localStorage.getItem('guestSession');
                const savedTime = localStorage.getItem('guestTimeLeft');
                const startTime = localStorage.getItem('guestStartTime');
                
                if (savedGuest === 'true' && savedTime && startTime) {
                    const elapsed = Math.floor((Date.now() - parseInt(startTime)) / 1000);
                    const remaining = parseInt(savedTime) - elapsed;
                    if (remaining > 0) {
                        // avoid re-triggering auth observer conflict: set isGuest true before starting
                        isGuest = true; // mark so that onAuthStateChanged doesn't hide dashboard
                        startGuestMode(remaining);
                    } else {
                        // expired while away
                        localStorage.removeItem('guestSession');
                        localStorage.removeItem('guestTimeLeft');
                        localStorage.removeItem('guestStartTime');
                    }
                }
            });

            // Before unload, save current time for guest
            window.addEventListener('beforeunload', () => {
                if (isGuest && timeLeft > 0) {
                    localStorage.setItem('guestTimeLeft', timeLeft);
                    localStorage.setItem('guestStartTime', Date.now());
                }
            });

        })();
    </script>
</body>
</html>